<!DOCTYPE html>
<html>
<head>
	<title>Maze</title>
	<meta charset="utf-8" />
	<style>
		* {
			margin: 0;
			padding: 0;
		}
		html, body {
			height: 100%;
		}
		body {
			display: flex;
			flex-direction: column;
			background-color: #272822;
		}
		#app {
			display: flex;
			flex-direction: row;
			height: 100%;
		}
		#editor {
			flex: 1;
		}
		#start-btn {
			display: inline-block;
			position: absolute;
			right: 2em;
			bottom: 2em;
			font-weight: bold;
			font-size: 24px;
		}
		.maze {
			display: flex;
			flex-direction: row;
			min-height: 15vw;
			max-height: 15vw;
			flex: 1;
		}
		.maze-row {
			display: flex;
			flex-direction: row;
			box-sizing: border-box;
			width: 100%;
		}
		.maze-container {
			display: flex;
			margin: 4px;
			flex: 1;
			flex-wrap: wrap;
		}
		.maze-row {
			display: flex;
			flex-direction: row;
			box-sizing: border-box;
			width: 100%;
		}
		.maze-container {
			display: flex;
			margin: 4px;
			flex: 1;
			flex-wrap: wrap;
		}
		.maze-cell {
			box-sizing: border-box;
			display: flex;
			background-color: rgb(255, 30, 0);
		}
		.wall-top { border-top: 1px solid lightgray }
		.wall-bottom { border-bottom: 1px solid lightgray }
		.wall-left { border-left: 1px solid lightgray }
		.wall-right { border-right: 1px solid lightgray }
	</style>
</head>
<body>
	<main id="app">
		<div id="editor" style="font-size: 16px">const step = (up, left, right, down, from) => {
  const from_index = ['left', 'up', 'right', 'down'].indexOf(from);

  const allowed = [up, right, down, left, up, right, down, left];
  return ['up', 'right', 'down', 'left', 'up', 'right', 'down', 'left']
      .find((dir, i) => i >= from_index && allowed[i]);
};</div>
		<div id="maze" class="maze"></div>
		<button id="start-btn">Play</button>
	</main>
	<script src="./node_modules/ace-builds/src-min-noconflict/ace.js" type="text/javascript"></script>
	<script src="js/mazes.js"></script>
	<script src="js/draw.js"></script>
	<script src="js/worker.js"></script>
	<script src="js/solution.js"></script>
	<script src="js/engine.js"></script>
	<script>
		const editor = ace.edit('editor');
		editor.setTheme('ace/theme/monokai');
		editor.session.setMode("ace/mode/javascript");
		const get_solution = () => `
			(() => {
				${editor.getValue()}
				return step;
			})();
		`;

		const start = () => init_mazes().map((c, i) => play(c)(mazes[i], get_solution()));

		document.getElementById('start-btn').addEventListener('click', start);
	</script>
</body>
</html>
